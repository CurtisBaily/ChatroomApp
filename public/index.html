<!doctype html>
<html>
<head>
    <title>Chatroom beta</title>
    <link rel="shortcut icon" href="/img/1412963727_259281.ico">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
</head>
<body>
    <div class="main">
        <div class="chat-header">
            <h3>Chatroom</h3>
            <p>Names: <span id="names"></span></p>
        </div>
        <div id="message-list">
            <ul id="messages"></ul>
        </div>
        <div class="message-input">
            <form action="">
                <input id="m" autocomplete="off" /><button>Send</button>
            </form>
        </div>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        var socket = io();
        var names = [];
        socket.name = prompt("Please enter your name");
        $('form').submit(function(){
            if( $('#m').val() !== '' ){
                socket.emit('chat message', {name: socket.name, message: $('#m').val() });
                $('#m').val('');
            }
            return false;
        });

        socket.on('chat message', function(msg){
            var name = msg.name;
            var message = msg.message;
            if (name === socket.name ){ 
                $('#messages').append($('<li class=\"own\">').text("You" + ": " + message));
            }
            else {
                if (names.indexOf(name) < 0) {
                    names[names.length] = name;
                }
                $('#names').text(names.join(", "));
                $('#messages').append($('<li class=\"stranger\">').text(name + ": " + message));
                document.title = "New message from " + name;
            }
            var elem = document.getElementById('message-list');
            elem.scrollTop = elem.scrollHeight;
        });

        $(this).mousemove(function(e){
            document.title = "Chatroom beta";
        });

        socket.on('new-user-online', function(usr){
            if (names.indexOf(usr) < 0) {
                names[names.length] = usr;
            }
        });
    </script>
</body>
</html>